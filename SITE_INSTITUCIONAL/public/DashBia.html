    <!DOCTYPE html>
    <html lang="pt-br">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Detalhamento de Servidores</title>
        <link rel="stylesheet" href="css/DashBia.css">

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    </head>

    <body>
        <div class="content">
            <button class="hamburger" onclick="Navbar()">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </button>

            <nav id="navMenu" class="nav-menu">
                <button class="close-btn" onclick="Navbar()">
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                </button>

                <img src="imagens/SecurePass SVGLogoNavBar.svg" alt="Logo" class="logo">

                <div class="separator"></div>

                <div class="nav-links">
                    <div class="dropdown">
                        <a class="dropdown-toggle">Dashboard</a>
                        <div class="dropdown-menu">
                            <a href="./dashGeral.html">Geral</a>
                            <a href="./dashSuporteAyrton.html">Velocidade de Resposta</a>
                            <a href="./DashBia.html">Saúde</a>
                            <a href="./dashGuilherme.html">Uso de Processos</a>
                        </div>
                    </div>
                    <a href="./dadosUsuario.html">Perfil</a>
                    <a href="./feedbackPublicar.html">Feedback</a>
                    <a href="https://securepasssp.atlassian.net/servicedesk/customer/portal/1">Suporte</a>
                </div>

                <div class="nav-link-space-logout">
                    <a href="index.html" class="logout">Sair</a>
                </div>

            </nav>
        </div>

        <div class="container">
            <h1>Saúde dos Servidores</h1>

            <!-- Indicador 1: Uso dos Componentes -->
            <section id="uso-componentes">
                <h2>Uso dos Componentes</h2>
                <div class="grid-container">
                    <div class="chart-container">
                        <h3>CPU </h3>
                        <canvas id="myChart1"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>RAM </h3>
                        <canvas id="myChart2"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Disco </h3>
                        <canvas id="myChart3"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Latência de Rede </h3>
                        <canvas id="myChart4"></canvas>
                    </div>
                </div>
            </section>

            <!-- Indicador 2: Histórico de Alertas -->
            <section id="historico-alertas">
                <div class="navegacao-historico">
                    <button onclick="irParaHistorico()">Ver Histórico de Alertas</button>
                </div>
            </section>
        </div>
        <script src="app.js"></script>
    </body>

    </html>
    <script>
        function Navbar() {
            const navMenu = document.getElementById('navMenu');
            const hamburger = document.querySelector('.hamburger');
            const closeBtn = document.querySelector('.close-btn');

            if (navMenu.classList.contains('show')) {
                navMenu.classList.remove('show');
                setTimeout(() => {
                    hamburger.style.display = 'block';
                    closeBtn.style.display = 'none';
                }, 300);
            } else {
                hamburger.style.display = 'none';
                closeBtn.style.display = 'block';
                navMenu.classList.add('show');
                hamburger.classList.add('active');
            }
        }
        let RAMChart;
        let CPUChart;
        let DISCOChart;
        let LatenciaChart;

        function toggleAlertSidebar() {
            const sidebar = document.getElementById('alertSidebar');
            sidebar.classList.toggle('show');
        }
        // Configuração do Gráfico de Linha (CPU)
        function obterDadosCPU() {
            var idDispositivo = sessionStorage.getItem('LINHA');

            fetch(`/medidas/CPU?idDispositivo=${idDispositivo}`, { cache: 'no-store' }).then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                        plotarCPU(resposta);

                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
                .catch(function (error) {
                    console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
                });
        }

        function plotarCPU(resposta) {

            let dados = [];

            for (i = resposta.length - 1; i >= 0; i--) {
                var registro = resposta[i];
                console.log(registro.valor)

                if (dados.length >= labelNRT.length) {
                    dados.shift();
                }

                dados.push(registro.valor);

            }

            if (CPUChart) {
                CPUChart.destroy();
            }
            // Criar  gráfico
            const cpuCtx = document.getElementById('myChart1').getContext('2d');
            CPUChart = new Chart(cpuCtx, {
                type: 'line',
                data: {
                    labels: labelNRT,
                    datasets: [{
                        label: 'Uso da CPU (%)',
                        data: dados,
                        borderColor: '#4caf50',
                        backgroundColor: 'rgba(76, 175, 80, 0.2)',
                        tension: 0.4
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            console.log(dados)
        }
        setInterval(() => {
            obterDadosCPU();
        }, 30000);

        // Configuração do Gráfico de Barras Empilhadas (RAM)

        function obterDadosRAM() {
            var idDispositivo = sessionStorage.getItem('LINHA');

            fetch(`/medidas/RAM/${idDispositivo}`, { cache: 'no-store' }).then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);


                        plotarRAM(resposta);

                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
                .catch(function (error) {
                    console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
                });
        }

        function plotarRAM(resposta) {

            let dados = [];

            for (i = resposta.length - 1; i >= 0; i--) {
                var registro = resposta[i];
                console.log(registro.valor)

                if (dados.length >= labelNRT.length) {
                    dados.shift();
                }

                dados.push(registro.valor);

            }

            if (RAMChart) {
                RAMChart.destroy();
            }

            // Criar o novo gráfico
            const ramCtx = document.getElementById('myChart2').getContext('2d');
            RAMChart = new Chart(ramCtx, {
                type: 'line',
                data: {
                    labels: labelNRT,
                    datasets: [{
                        label: 'GB',
                        data: dados,
                        borderWidth: 2,
                        backgroundColor: 'rgba(36, 130, 50, 1)',
                        borderColor: 'rgba(36, 130, 50, 1)'
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            console.log(dados)
        }
        setInterval(() => {
            obterDadosRAM();
        }, 30000);

        // Configuração do Gráfico de Linha (Disco)

        function obterDadosDISCO() {
            var idDispositivo = sessionStorage.getItem('LINHA');

            fetch(`/medidas/DISCO/${idDispositivo}`, { cache: 'no-store' }).then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);


                        plotarDISCO(resposta);

                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
                .catch(function (error) {
                    console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
                });
        }
        function plotarDISCO(resposta) {

            let dados = [];

            var registro = resposta[0];
            console.log(registro.valor)
            var resto = 100 - registro.valor;

            dados.push(registro.valor);
            dados.push(resto)


            if (DISCOChart) {
                DISCOChart.destroy();
            }

            // Criar grafico
            const diskCtx = document.getElementById('myChart3').getContext('2d');
            DISCOChart = new Chart(diskCtx, {
                type: 'line',
                data: {
                    labels: ['10s', '20s', '30s', '40s', '50s', '60s'],
                    datasets: [{
                        label: 'Uso do Disco (%)',
                        data: dados,
                        borderColor: '#2196f3',
                        backgroundColor: 'rgba(33, 150, 243, 0.2)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: true } }
                }
            });
            console.log(dados)
        }
        setInterval(() => {
            obterDadosDISCO();
        }, 30000);

        
        // Função para obter os dados de Velocidade de Rede
    function obterDadosLatencia() {
        var idDispositivo = sessionStorage.getItem('LINHA');

        fetch(`/medidas/TempoResposta/${idDispositivo}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    plotarLatencia(resposta);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados para gráfico de velocidade: ${error.message}`);
        });
    }

    // Função para plotar o gráfico de Velocidade de Rede
    function plotarLatencia(resposta) {
        let dados = [];

        for (i = resposta.length - 1; i >= 0; i--) {
            var registro = resposta[i];
            console.log(registro.valor)

            if (dados.length >= labelNRT.length) {
                dados.shift();
            }

            dados.push(registro.valor);
        }

        if (LatenciaChart) {
            LatenciaChart.destroy();
        }

        // Criar gráfico 
        const LatenciaChartCtx = document.getElementById('myChart4').getContext('2d');
        LatenciaChart = new Chart(LatenciaChartCtx, {
            type: 'line',
            data: {
                labels: labelNRT,
                datasets: [{
                    label: 'Velocidade de Rede (Mbps)',
                    data: dados,
                    borderColor: '#ff9800',
                    backgroundColor: 'rgba(255, 152, 0, 0.2)',
                    tension: 0.4
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
        console.log(dados);
    }

    setInterval(() => {
        obterDadosVelocidade();
    }, 30000);

    </script>